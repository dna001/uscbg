/******************************************************************************
Copyright (c) 2003, All Rights Reserved.
******************************************************************************/

/*---------------------------------------------------------------------------*/
/*! \file dlnk.c
\brief The dlnk implementation. */
/*---------------------------------------------------------------------------*/
/* INCLUDE FILES *************************************************************/
#include "sys_def.h"
#include "sys_assert.h"
#include "dlnk.h"

/* CONTANTS / MACROS *********************************************************/

/* LOCAL DATATYPES ***********************************************************/

/* LOCAL FUNCTION PROTOTYPES *************************************************/

/* MODULE CONSTANTS / VARIABLES **********************************************/
SYS_DBC_FILE;  /*!< Defines the name of this source file once for all */

/* GLOBAL CONSTANTS / VARIABLES **********************************************/

/* GLOBAL FUNCTIONS **********************************************************/
/*-----------------------------------------------------------------------------
-----------------------------------------------------------------------------*/
void dlnk_init(dlnk_t* p_lnk)
{
   REQUIRE(p_lnk);
   p_lnk->p_prev = p_lnk;
   p_lnk->p_next = p_lnk;
}

/*-----------------------------------------------------------------------------
-----------------------------------------------------------------------------*/
dlnk_t* dlnk_add(dlnk_t* p_pos, dlnk_t* p_obj)
{
   REQUIRE(p_pos);
   REQUIRE(p_obj);
   ( p_obj->p_next = p_pos->p_next )->p_prev = p_obj;
   ( p_pos->p_next = p_obj )->p_prev = p_pos;
   return p_obj->p_next;
}

/*-----------------------------------------------------------------------------
-----------------------------------------------------------------------------*/
dlnk_t* dlnk_insert(dlnk_t* p_pos, dlnk_t* p_obj)
{
   return dlnk_add(p_pos->p_prev, p_obj);
}

/*-----------------------------------------------------------------------------
-----------------------------------------------------------------------------*/
dlnk_t* dlnk_remove(dlnk_t* p_obj)
{
   dlnk_t* p_next = p_obj->p_next;

   REQUIRE(p_obj);
   REQUIRE(p_obj->p_next);
   REQUIRE(p_obj->p_prev);
   ( p_obj->p_prev->p_next = p_next )->p_prev = p_obj->p_prev;
   p_obj->p_next = p_obj->p_prev = p_obj;
   return p_next;
}

/*----------------------------------------------------------------------------
----------------------------------------------------------------------------*/
dlnk_t* dlnk_next(const dlnk_t* p_pos)
{
   REQUIRE(p_pos);
   return p_pos->p_next;
}

/*----------------------------------------------------------------------------
----------------------------------------------------------------------------*/
dlnk_t* dlnk_prev(const dlnk_t* p_pos)
{
   REQUIRE(p_pos);
   return p_pos->p_prev;
}

/*----------------------------------------------------------------------------
----------------------------------------------------------------------------*/
dlnk_t* dlnk_for_each(dlnk_t* p_head, dlnk_fn_t* fn, void* p_prm)
{
   dlnk_t* p_pos = dlnk_next(p_head);

   REQUIRE(p_head && fn);
   do
   {
      if (fn(p_pos, p_prm))
      {
         break;
      }
      p_pos = dlnk_next(p_pos);
   }
   while (p_pos != p_head);
   if (p_pos == p_head)
   {
      p_pos = NULL;
   }
   return p_pos;
}

/* LOCAL FUNCTIONS ***********************************************************/
/*-----------------------------------------------------------------------------
-----------------------------------------------------------------------------*/

/* END OF FILE ***************************************************************/
